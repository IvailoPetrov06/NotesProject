{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport EventCard from \"./EventCard\";\nimport moment from \"moment\";\nimport { getEvents } from \"./EventService\";\nimport { formatDate, getCountdownParts } from \"./util\";\nimport { NotificationContainer, NotificationManager } from 'react-notifications';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar notifSeen = false;\n\nvar EventList = function (_Component) {\n  _inherits(EventList, _Component);\n\n  var _super = _createSuper(EventList);\n\n  function EventList() {\n    var _this;\n\n    _classCallCheck(this, EventList);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      events: []\n    };\n    return _this;\n  }\n\n  _createClass(EventList, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.props.navigation.addListener('focus', function () {\n        getEvents().then(function (events) {\n          return _this2.setState({\n            events: events\n          });\n        }).then(function (events) {\n          _this2.state.events.forEach(function (element) {\n            Notification(element);\n            notifSeen = false;\n          });\n        });\n      });\n      setInterval(function () {\n        _this2.setState({\n          events: _this2.state.events.map(function (item) {\n            return _objectSpread(_objectSpread({}, item), {}, {\n              updateTime: Date.now()\n            });\n          })\n        });\n      }, 1000);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return _jsxs(View, {\n        style: styles.listView,\n        children: [_jsx(FlatList, {\n          data: this.state.events,\n          renderItem: function renderItem(_ref) {\n            var item = _ref.item;\n            return _jsx(EventCard, {\n              eventItem: item\n            });\n          }\n        }), _jsx(Button, {\n          onPress: function onPress() {\n            return _this3.props.navigation.navigate(\"EventForm\");\n          },\n          title: \"\\u0434\\u043E\\u0431\\u0430\\u0432\\u0438 \\u0443\\u0447\\u0435\\u043D\\u0438\\u043A\"\n        })]\n      });\n    }\n  }]);\n\n  return EventList;\n}(Component);\n\nexport default EventList;\n\nfunction Notification(studentItem) {\n  var countdown = null;\n  var unexcusedAbsence = null;\n  var notExcused = false;\n\n  if (notifSeen === false) {\n    studentItem.absences.forEach(function (absence) {\n      if (!absence.excused) {\n        notExcused = true;\n        unexcusedAbsence = absence.date;\n        countdown = getCountdownParts(moment(unexcusedAbsence, \"DD/MM/YYYY hh:mm\").toString());\n        console.log(moment(absence.date, \"DD/MM/YYYY hh:mm\").toString());\n        console.log(countdown);\n      }\n    });\n\n    if (notExcused) {\n      if (countdown.days <= -3) {\n        notifSeen = true;\n        NotificationManager.info(studentItem.title + \" \\u0438\\u043C\\u0430 \\u0435\\u0434\\u043D\\u043E \\u0438\\u043B\\u0438 \\u043F\\u043E\\u0432\\u0435\\u0447\\u0435 \\u043D\\u0435\\u0438\\u0437\\u0432\\u0438\\u043D\\u0435\\u043D\\u0438 \\u043E\\u0442\\u0441\\u044A\\u0441\\u0442\\u0432\\u0438\\u044F\", \"Неизвинени отсъствия\", 4000);\n      }\n    }\n  }\n}\n\nvar styles = StyleSheet.create({\n  listView: {\n    paddingBottom: 40\n  }\n});","map":{"version":3,"sources":["D:/Упражнения 9 клас/Мобилни приложения/NotesProject/EventList.js"],"names":["React","Component","EventCard","moment","getEvents","formatDate","getCountdownParts","NotificationContainer","NotificationManager","notifSeen","EventList","state","events","props","navigation","addListener","then","setState","forEach","element","Notification","setInterval","map","item","updateTime","Date","now","styles","listView","navigate","studentItem","countdown","unexcusedAbsence","notExcused","absences","absence","excused","date","toString","console","log","days","info","title","StyleSheet","create","paddingBottom"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { View, Button, StyleSheet } from \"react-native\";\r\nimport { FlatList } from \"react-native\";\r\nimport EventCard from \"./EventCard\";\r\nimport moment from \"moment\";\r\nimport { getEvents } from \"./EventService\";\r\nimport { formatDate, getCountdownParts } from \"./util\";\r\nimport {NotificationContainer, NotificationManager} from 'react-notifications';\r\n\r\nlet notifSeen = false;\r\n\r\nclass EventList extends Component {\r\n  state = {\r\n    events: [],\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.props.navigation.addListener('focus', () => {\r\n      getEvents().then(events => this.setState({events})).then(events => {\r\n        this.state.events.forEach(element => {\r\n          Notification(element);\r\n          notifSeen = false;\r\n        });\r\n      });\r\n    });\r\n\r\n    setInterval(() => {\r\n      this.setState({\r\n        events: this.state.events.map(item => ({\r\n          ...item,\r\n          updateTime: Date.now()\r\n        }))\r\n      });\r\n    }, 1000);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <View style={styles.listView}>\r\n        <FlatList\r\n          data={this.state.events}\r\n          renderItem={({ item }) => <EventCard eventItem={item} />}\r\n        ></FlatList>\r\n        <Button\r\n          onPress={() => this.props.navigation.navigate(\"EventForm\")}\r\n          title=\"добави ученик\"\r\n        />\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default EventList;\r\n\r\nfunction Notification(studentItem){\r\n  let countdown = null;\r\n  let unexcusedAbsence = null;\r\n  let notExcused = false;\r\n  if (notifSeen === false) {\r\n    studentItem.absences.forEach(absence => {\r\n      if (!absence.excused) {\r\n        notExcused = true;\r\n        unexcusedAbsence = absence.date;\r\n        countdown = getCountdownParts(moment(unexcusedAbsence, \"DD/MM/YYYY hh:mm\").toString());\r\n        console.log(moment(absence.date, \"DD/MM/YYYY hh:mm\").toString());\r\n        console.log(countdown);\r\n      }\r\n    });\r\n    if (notExcused) {\r\n      if (countdown.days <= -3) {\r\n        notifSeen = true;\r\n        NotificationManager.info(`${studentItem.title} има едно или повече неизвинени отсъствия`, \"Неизвинени отсъствия\", 4000);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  listView: {\r\n    paddingBottom: 40,\r\n  },\r\n})"]},"metadata":{},"sourceType":"module"}